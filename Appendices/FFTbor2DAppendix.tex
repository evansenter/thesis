% %!TEX root = ../main.tex

% \chapter{FFTbor2D Appendix}
% \label{ch:ffttwoapp}

% \lhead{FFTbor2D Appendix}

% \section{Full Recursions for \texorpdfstring{\emZ{i,j}}{}
% for the Turner Energy Model}
% \label{sec:ffttwo:turner}

% To compute $\emZ{} = \emZ{1,n}$, we use the recursions

% \begin{align}
% \label{eq:fftborapp:zx}
% \emZ{i,j} = \emZ{i,j-1} \cdot x^{d_0} +
% \sum_{\mathclap{\substack{(s_k,s_j) \in \bpSet, \\ i \leq k < j}}}\enspace
% \Big( \emZ{i,k-1} \cdot \emZB{k,j} \cdot \boltzE{E_d} \cdot x^{d_1} \Big),
% \end{align}

% where $d_0 = 1$ if $j$ is base paired
% in $\str_{[i,j]}$ and $0$ otherwise, where $d_1 =
% \dBP{\str_{[i,j]}}{\str_{[i,k-1]} \cup \str_{[k,j]}}$, and
% where $E_d$ is the energy contribution due to dangling ends (energy
% contributions from single bases stacking on adjacent base pairs) and
% closing AU base pairs (since a non GC base pair closing a stem has a
% destabilizing effect).  The sum is taken over all possible
% base pairs $(k,j)$ with $i \le k < j$.

% We compute \emZB{} using the recursion

% \begin{align}
% \label{eq:fftborapp:zbx}
% \begin{split}
% \emZB{i,j} &= \boltzE{EH(i,j)} \cdot x^{d_2} \\
% &+ \sum_{\mathclap{\substack{(s_k,s_l) \in \bpSet, \\ i < k < l < j }}}\enspace
% \emZB{k,l} \cdot \boltzE{EI(i,j,k,l)} \cdot x^{d_3} \\
% &+ \sum_{\mathclap{\substack{(s_k,s_l) \in \bpSet, \\ i < k < l < j }}}\enspace
% \Big( \emZM{i+1,k-1} \cdot \emZB{k,l} \cdot \boltzE{(a+b+c(j-l-1))}
% \cdot x^{d_4} \Big)
% \end{split}
% \end{align}

% where $d_2 = \dBP{\str_{[i,j]}}{\{(i,j)\}}$,
% where $EH(i,j)$ is the energy of the hairpin loop with closing base
% pair $(i,j)$, $EI(i,j,k,l)$ is the energy of the stack, bulge or
% interior loop with the closing base pair $(i,j)$ and the interior
% base pair $(k,l)$, $d_3 = \dBP{\str_{[i,j]}}{\str_{[k,l]} \cup
% \{(i,j)\}}$, and $d_4 = \dBP{\str_{[i,j]}}{\str_{[i+1,k-1]} \cup
% \str_{[k,l]} \cup\{(i,j)\}}$.  The first term in the
% recursion takes care of the case where $(i,j)$ is the only base pair
% in $[i,j]$, i.e. $(i,j)$ closes a hairpin loop. The second term
% handles the case where there is an interior loop (or a bulge or a
% stack) closed by $(i,j)$ and $(k,l)$. The third term takes care of
% all the structures where $(i,j)$ closes a multiloop. To reduce
% complexity of the algorithm, the interior and bulge loop size can be
% limited to a maximum size of $L$, by requiring that $l>j-L$ in the
% above recursion.

% The final recursion, for computing \emZM{}, is

% \begin{align}
% \label{eq:fftborapp:zmx}
% \begin{split}
% \emZM{i,j} &= \emZM{i,j-1} \cdot \boltzE{c} \cdot x^{d_0} \\
% &+ \sum_{\mathclap{\substack{(s_k,s_j) \in \bpSet, \\ i \leq k < j }}}\enspace
% \Big( \emZB{k,j} \cdot \boltzE{(b+c(k-i))} \cdot x^{d_5} \\
% &+ \emZM{i,k-1} \cdot \emZB{k,j} \cdot \boltzE{b} \cdot x^{d_6} \Big)
% \end{split}
% \end{align}

% where $d_5 = \dBP{\str_{[i,j]}}{\str_{[k,j]}}$ and $d_6
% =\dBP{\str_{[i,j]}}{\str_{[i,k-1]} \cup \str_{[k,j]}}$.
% Note that since $\emZM{i,j}$ computes the partition function
% contribution under the assumption that $[i,j]$ is part of a
% multiloop, there will be exactly one stem-loop structure in this
% region (the \emZB{} term) or
% more than one (the \emZM{}-\emZB{} term).
% Justification of recursions (\ref{eq:fftborapp:zx}),
% (\ref{eq:fftborapp:zbx}), and
% (\ref{eq:fftborapp:zmx})
% follow by induction, as in the proof of Theorem \ref{thm:fftbor:recursions}.

% \section{Full Recursions for \texorpdfstring{\emZ{i,j}}{}
% for the Turner Energy Model}
% \label{sec:ffttwo:theorems}

% Here, we provide proofs of Theorem 1 and of Lemmas 2,3,4.
% \smallskip

% \noindent
% {\sc Theorem 1:} Let $s_1,\ldots,s_n$ be a given RNA sequence.
% For any integers $1 \leq i \leq j \leq n$, let
% $\Z_{i,j}(x) = \sum_{r=0}^{n-1} \sum_{s=0}^{n-1} z_{rn+s}  x^{rn+s}$
% where
% $z_{rn+s}(i,j)= \z{rn+s}{i}{j}$.
% Then  for $i\leq j \leq i+\theta$, $\Z_{i,j}(x)=1$ and for
% $j>i+\theta$ we have the recurrence relation
% \begin{eqnarray}
% \label{eqn:polynomialRecursionNussJac1}
% \Z_{i,j}(x) &= \Z_{i,j-1}(x) \cdot x^{\alpha_0n+\beta_0} + \\
% &\sum_{\substack{s_k s_j \in \mathbb{B},\\i\le k<j}}
% \left(e^{\frac{-E_0(k,j)}{RT}}\cdot
% \Z_{i,k-1}(x)\cdot\Z_{k+1,j-1}(x)\cdot x^{\alpha(k)n+\beta(k)} \right)
% \nonumber
% \end{eqnarray}
% where $\alpha_0 = 1$ if $j$ is base-paired in $A_{[i,j]}$ and $0$ otherwise,
% $\beta_0 = 1$ if $j$ is base-paired in $B_{[i,j]}$ and $0$ otherwise, and
% $\alpha(k)=d_{BP}(A_{[i,j]}, A_{[i,k-1]} \cup A_{[k+1,j-1]} \cup\{(k,j)\})$,
% $\beta(k)=d_{BP}(B_{[i,j]}, B_{[i,k-1]} \cup B_{[k+1,j-1]} \cup\{(k,j)\})$.
% \smallskip

% \noindent
% {\sc Proof:}
% First, some notation is necessary. Recall that if $F$ is an arbitrary
% polynomial [resp. analytic] function, then $[x^{rn+s}] F(x)$
% denotes the coefficient of monomial $x^{rn+s}$ in the
% Taylor expansion of $F(x)$] -- for instance, in equation~(3) of the main text,
% $[x^{rn+s}]Z(x) = z_{rn+s}$.

% By definition, it is clear that $\Z_{i,j}(x)=1$ if $i\leq j \leq i+\theta$,
% where we recall that $\theta = 3$ is the minimum number of unpaired bases in
% a hairpin loop.  For $j>i+\theta$, we have
% \begin{eqnarray*}
% [x^{rn+s}] \Z_{i,j}(x) &=& z_{rn+s}(i,j) = \z{rn+s}{i}{j}\\
% &=&\z{(r-\alpha_0)n+(s-\beta_0)}{i}{j-1} + \sum_{k=i}^{j-1}
% \sum_{u_0+u_1 = r-\alpha(k)} \sum_{v_0+v_1 = s-\beta(k)}
% e^{\frac{-E_0(k,j)}{RT}} \cdot \z{u_0n+v_0}{i}{k-1} \cdot
% \z{u_1n+v_1}{k+1}{j-1} \\
% &=&
% [x^{(r-\alpha_0)n+(s-\beta_0)}] \Z_{i,j-1}(x) + \\
% & &
% \sum_{k=i}^{j-1}
% \sum_{u_0+u_1 = r-\alpha(k)}
% \sum_{v_0+v_1 = s-\beta(k)}
% e^{\frac{-E_0(k,j)}{RT}} \cdot \left\{ [x^{u_0n+v_0}]
% \Z_{i,k-1}(x) \right\} \cdot
% \left\{ [x^{u_1n+v_1}] \Z_{k-1,j-1}(x) \right\} \\
% &=&
% [x^{(r-\alpha_0)n+(s-\beta_0)}] \Z_{i,j-1}(x) + \\
% & &
% \sum_{k=i}^{j-1}
% \sum_{u_0+u_1 = r-\alpha(k)}
% \sum_{v_0+v_1 = s-\beta(k)}
% e^{\frac{-E_0(k,j)}{RT}} \cdot [x^{(u_0+u_1)n+(v_0+v_1)}] \Z_{i,k-1}(x)
% \Z_{k-1,j-1}(x) \\
% &= &
% [x^{(r-\alpha_0)n+(s-\beta_0)}] \Z_{i,j-1}(x) + %+++\\
% %+++& &
% \sum_{k=i}^{j-1}
% e^{\frac{-E_0(k,j)}{RT}} \cdot [x^{(r-\alpha(k))n+(s-\beta(k))}] \Z_{i,k-1}(x)
% \Z_{k-1,j-1}(x) \\
% &= &
% [x^{rn+s}] \left( \Z_{i,j-1}(x) \cdot x^{\alpha_0n+\beta_0} \right) +
% \sum_{k=i}^{j-1}
% e^{\frac{-E_0(k,j)}{RT}} \cdot
% [x^{rn+s}] \left(  \Z_{i,k-1}(x) \Z_{k-1,j-1}(x) x^{\alpha(k)n+\beta(k)}
% \right) \\
% &= &
% [x^{rn+s}] \left(
% \Z_{i,j-1}(x) \cdot x^{\alpha_0n+\beta_0}  + \sum_{k=i}^{j-1}
% e^{\frac{-E_0(k,j)}{RT}} \cdot
% \Z_{i,k-1}(x) \Z_{k-1,j-1}(x) x^{\alpha(k)n+\beta(k)} \right).
% \end{eqnarray*}
% By induction, the proof of the theorem now follows. $\Box$
% \medskip

% The following lemma was proved in \cite{fftbor}, and is reproduced
% for the convenience of the reader.

% \noindent
% {\sc Lemma 2:} If $\Z(x)$ is the complex polynomial defined in
% %equation~(\ref{eqn:polynomialYann}), then for any complex $n$th root of
% equation~(9) of the main text, then for any complex $n$th root of
% unity $\alpha$, it is the case that $\Z(\overline{\alpha}) =
% \overline{\Z(\alpha)}$. In other words, if $\alpha$ is a complex $n$th root
% of unity of the form $a+bi$, where $a,b \in \mathbb{R}$ and $b>0$, and
% if $\Z(a+bi) = A + Bi$ where $A,B \in \mathbb{R}$, then it is the case that
% \[
% \Z(a - bi) = A - Bi.
% \]
% \smallskip

% \noindent
% {\sc Proof:}
% Letting $i = \sqrt{-1}$, if  $\theta = \frac{2 \pi}{n}$, then
% $\omega = e^{i \theta} = \cos(\theta) + i \sin(\theta)$
% is the principal $n$th complex root of unity, and
% $1=\omega^{0},\ldots,e^{(n-1)\cdot i \theta}=\omega^{n-1}$ together
% constitute the complete collection of all
% $n$th complex roots of unity -- i.e. the $n$ unique solutions of
% of the equation $x^n -1 = 0$ over the field $\mathbb{C}$ of complex numbers.
% Clearly, for any $1 \leq r < n$,
% $e^{-i r \theta} = 1 \cdot e^{-i r \theta} =
% e^{2 \pi i} \cdot e^{-i r \theta} = e^{i(2 \pi - r \theta)} =
% e^{i(n \theta - r \theta)} = e^{i \theta (n - r)}$.
% Moreover, if $\omega^r = e^{i r \theta} = a + b i$ where
% $b>0$, then we have $e^{-i r \theta} = a-bi$. It follows that for any
% $n$th root of unity of the form $a+bi$, where $b>0$, the number $a-bi$
% is also an $n$th root of unity.

% Recall that $\Z(x) = \sum_{k=0}^n c_k x^k$, where
% $c_k\in \mathbb{R}$ are real numbers representing the partition function
% $\z{k}{1}{n}$ over
% all secondary structures of a given RNA sequence $s_1,\ldots,s_n$,
% whose base pair distance from initial structure
% $S^*$ is $k$. Thus, in order to prove the lemma, it suffices to show
% that for all values $k=0,\ldots,n-1$, if $a+bi$ is a complex $n$th
% root of unity, where $a,b \in \mathbb{R}$
% and $b>0$, and if $(a+bi)^k = C+Di$ where $C,D \in \mathbb{R}$, {\em then}
% $(a-bi)^k = C-Di$. Indeed, we have the following.

% \begin{eqnarray*}
% (a+bi)^m &=& \sum_{k=0}^m {m \choose k} a^{m-k}\cdot  (bi)^k \\
% (bi)^k  &=& \left\{
% \begin{array}{ll}
% b^k &\mbox{if $k \equiv 0 \bmod 4$}\\
% i b^k &\mbox{if $k \equiv 1 \bmod 4$}\\
% -b^k &\mbox{if $k \equiv 2 \bmod 4$}\\
% -i b^k &\mbox{if $k \equiv 3 \bmod 4$}\\
% \end{array} \right.
% \end{eqnarray*}
% \begin{eqnarray*}
% (a-bi)^m &=& \sum_{k=0}^m {m \choose k} a^{m-k} \cdot (-bi)^k \\
% (-bi)^k &=& \left\{
% \begin{array}{ll}
% b^k &\mbox{if $k \equiv 0 \bmod 4$}\\
% -ib^k &\mbox{if $k \equiv 1 \bmod 4$}\\
% -b^k &\mbox{if $k \equiv 2 \bmod 4$}\\
% ib^k &\mbox{if $k \equiv 3 \bmod 4$}\\
% \end{array} \right.
% \end{eqnarray*}
% It follows that each term of the form
% $a^{m-k} \cdot (bi)^k$, for $k=0,\ldots,m$, is the complex conjugate of
% $a^{m-k} \cdot (-bi)^k$, and thus $(a+bi)^m$ is the complex conjugate of
% $(a-bi)^m$. Since $\Z(a+bi)$ is a sum of terms of the form $c_k (a+bi)^k$,
% it follows that $\Z(a-bi)$ is the complex conjugate of $\Z(a+bi)$.
% This completes the proof of the lemma. \hfill  $\Box$
% \medskip


% \noindent
% {\sc Lemma 3:} Let $d_0=d_{BP}(A,B)$.  Then for any complex number
% $\alpha \in \mathbb{C}$,  $Z(-\alpha)= -1^{d_0} \cdot Z(\alpha)$.
% \medskip

% \noindent
% {\sc Proof:}
% The lemma states that if the base pair distance between reference
% structures $A,B$ is even, then $Z(-\alpha)=Z(\alpha)$, while if
% the distance is odd, then $Z(-\alpha)=-Z(\alpha)$. Suppose first that
% $d_0$ is even. By Lemma 1,
% $Z(x) = z_0 + z_2 x^2 + z_4 x^4 + \cdots +
% z_{M-2)} x^{M-2)}$, and so $Z(-\alpha) = Z(\alpha)$.
% Suppose now that
% $d_0$ is odd. By Lemma 1,
% $Z(x) = z_1 x^1 + z_3 x^3 + z^5 x^5 \cdots +
% z_{M-1} x^{M-1}$, and so $Z(-\alpha) = -Z(\alpha)$.
% \medskip

% \noindent
% {\sc Lemma 4:} Suppose that $\nu = \exp(\frac{2 \pi i}{M})$ is
% the principal $M$-root of unity, and that
% $\frac{M}{4} < k \leq \frac{M}{2}$. Then
% \[
% \nu^k = -(\nu^{-(M/2-k)}) = - \overline{\nu^{M/2-k}}.
% \]
% \medskip

% \noindent
% {\sc Proof:} Recall Euler's formula in complex analysis:
% $\exp( ix) = \cos(x) + i \sin(x)$. As well, recall that
% $\sin(\pi)=0$, $\cos(\pi)=-1$, and the trigonometric
% addition formulas:
% \begin{eqnarray*}
% \cos(\alpha-\beta) &=& \cos(\alpha) \cos(\beta) + \sin(\alpha) \sin(\beta)\\
% \sin(\alpha-\beta) &=& \sin(\alpha) \cos(\beta) - \sin(\beta) \cos(\alpha).
% \end{eqnarray*}
% Then
% \begin{eqnarray*}
% \nu^{M/2-k} &=& \exp\left(\frac{2 \pi i (M/2-k)}{M}\right) \\
% &=& \cos\left(\frac{2 \pi (M/2-k)}{M}\right) + i
% \sin\left(\frac{2 \pi (M/2-k)}{M}\right) \\
% &=& \cos\left(\pi - \frac{2 \pi k}{M}\right) + i
% \sin\left(\pi - \frac{2 \pi k}{M}\right) \\
% &=&
% \left[
% \cos(\pi) \cos\left(\frac{2 \pi k}{M}\right) +
% \sin(\pi) \sin\left(\frac{2 \pi k}{M}\right)
% \right] + \\
% &&
% \left[
% \sin(\pi) \cos\left(\frac{2 \pi k}{M}\right) -
% \sin\left(\frac{2 \pi k}{M}\right) \cos(\pi)
% \right] \\
% &=&
% -\cos\left(\frac{2 \pi k}{M}\right) + i
% \sin\left(\frac{2 \pi k}{M}\right) \\
% &=&
% -1 \left[ \cos\left(\frac{2 \pi k}{M}\right) - i
% \sin\left(\frac{2 \pi k}{M}\right) \right] \\
% &=&
% -1 \cdot \overline{\cos\left(\frac{2 \pi k}{M}\right) + i
% \sin\left(\frac{2 \pi k}{M}\right)}  \\
% &=&
% -1 \cdot \overline{\exp\left(\frac{2 \pi i k}{M}\right)} = - \overline{\nu^k} . \\
% \end{eqnarray*}
% It follows that
% $\nu^{M/2-k} = -\overline{\nu^k}$, so
% $\nu^{k} = \overline{- \nu^{(M/2-k)}} = -\overline{\nu^{(M/2-k)}}$.
% This completes the proof of the lemma.



